# `risk_haplotype_sequence_vcf.py`

![Python](https://img.shields.io/badge/python-3.x-blue.svg)
![License](https://img.shields.io/badge/license-GPL--3.0-blue)

ðŸ”— [`risk_haplotype_sequence_vcf.py`](./risk_haplotype_sequence_vcf.py)

**Version:** 1.0  
**Author:** Rafael Nafikov  
**Date:** 2025-06-20

---

## Table of Contents
- [Folder Structure](#folder-structure)
- [Overview](#overview)
- [Requirements](#requirements)
- [Usage](#usage)
- [Arguments](#arguments)
- [Input Files](#input-files)
- [Output Files](#output-files)
- [Example](#example)
- [License](#license)
- [Support](#support)

---

## Folder Structure

```
risk_haplotype_sequence_to_VCF/
â”œâ”€â”€ input_files
â”‚Â Â  â”œâ”€â”€ 1000_Genomes_Project_chr16_unphased.vcf.gz
â”‚Â Â  â”œâ”€â”€ chr16_SNV_genomic_positions_B38.txt
â”‚Â Â  â””â”€â”€ shared_haplotype.txt
â”œâ”€â”€ output_files
â”‚Â Â  â”œâ”€â”€ genomic_windows.txt
â”‚Â Â  â”œâ”€â”€ risk_haplotype_sequence_vcf.log
â”‚Â Â  â””â”€â”€ risk_haplotype.vcf
â”œâ”€â”€ README.md
â””â”€â”€ risk_haplotype_sequence_vcf.py

```

3 directories, 8 files

Folders containing input and output files are zipped to save space.

---

## Overview

`risk_haplotype_sequence_vcf.py` is a Python utility designed to generate a VCF file from a risk (shared) haplotype sequence produced by HaploGI during a haplotype sharing run.

The script uses the specified risk haplotype boundaries and metadata from a VCF file (originally used to generate genotype data for HaploGI runs). It outputs a VCF-formatted file containing the risk haplotype sequence, making it suitable for follow-up analyses.

---

## Requirements

- Python 3.x  
- No external dependencies (standard library only)

---

## Usage

Run the script from the command line with the required inputs:

```bash
python risk_haplotype_sequence_vcf.py \
       --start_pos <start_position> \
       --end_pos <end_position> \
       --haplotypes <risk_haplotype_file> \
       --vcf <input_vcf_file(.vcf or .vcf.gz)> \
       --positions <position_blocks_file> \
      [--output_dir <folder_path>]
```
 
---

## Arguments

| Argument      | Required | Description                                                                                   |
|---------------|----------|-----------------------------------------------------------------------------------------------|
| `--start_pos`   | Yes      | Starting position (base pair) for the genomic region to processâ€”left boundary of the risk haplotype. |
| `--end_pos`     | Yes      | Ending position (base pair) for the genomic region to processâ€”right boundary of the risk haplotype. |
| `--haplotypes`  | Yes      | Path to the risk (shared) haplotype sequences file generated by HaploGI.                       |
| `--vcf`         | Yes      | Input VCF file containing metadata for output VCF (supports `.vcf` and `.vcf.gz` formats).     |
| `--positions`   | Yes      | Path to the SNV genomic positions file.                                                       |
| `--output_dir`  | No       | Directory where the output VCF file and log will be saved (defaults to the current directory). |
| `--output`      | No       | Output VCF file name with HaploGI-phased risk haplotype WGS data.                             |
| `--log`         | No       | Optional log file to record processing details and errors.                                    |

---

## Input Files

### ðŸ”· `shared_haplotype.txt`
```bash
16:1052701-1055604 22222212211222211212
16:1127696-1132994 11111222221112211212
16:1506499-1511322 11111121111111111111
16:1511338-1513919 11111111111111111111
```

- Genomic region in format `chr:start_bp-end_bp`
- Sample ID with haplotype suffix `_0` or `_1`
- Phased sequence string for the region

### ðŸ”· `chr16_SNV_genomic_positions_B38`
```bash
1052701 3.767099
1052874 3.767696
1053095 3.768460
```

- Physical base pair position for each variant
- Genomic position of the variant in cM

### ðŸ”· `unphased_WGS_data.vcf`

  A standard VCF file containing unphased genotypes, which is used as input to generate the genotype data file for the HaploGI run.

---

## Output Files

### ðŸŸ¢ `genomic_windows.txt`:  
  

```bash
genomic_window	boundaries	var1	var2	var3	var4	var5	var6	var7	var8	var9	var10	var11	var12	var13	var14	var15	var16	var17	var18	var19	var20	var1_cM_pos	var20_cM_pos
1	1052701-1055604	1052701	1052874	1053095	1053154	1053316	1053758	1053890	1054244	1054249	1054409	1054446	1054491	1054508	1054606	1054612	1054759	1055201	1055294	1055431	1055604	3.767099	3.77713
2	1055638-1059301	1055638	1055760	1055783	1055819	1055825	1055873	1055899	1055919	1055937	1055966	1056064	1057345	1057865	1058373	1058485	1058669	1058884	1059044	1059178	1059301	3.777248	3.789907
```
Where each row represents a genomic window, and the columns are as follows:

- genomic_window: Sequential genomic window number.

- boundaries: The genomic positions marking the start and end of the window (1st variant base pair position to the 20th variant base pair position).

- var1 to var20: Base pair positions for 20 variants comprising the genomic window.

- var1_cM_pos and var20_cM_pos: The genomic position in centimorgan (cM) for the 1st and 20th variants within the genomic window.

### ðŸŸ¢ `risk_haplotype.vcf`:  
  VCF v4.2-compliant output containing the phased risk haplotype sequences. 

### ðŸŸ¢ `risk_haplotype_sequence_vcf.log`:  
  A log summary of the processing steps, including any warnings and errors encountered during execution.
   
---

## Example

Unzip the `input_files` directory before running the script. Use the included example inputs to run:

```bash
python risk_haplotype_sequence_vcf.py \
      --start_pos 1831445 \
      --end_pos 8321356 \
      --haplotypes ./input_files/shared_haplotype.txt \
      --vcf ./input_files/1000_Genomes_Project_chr16_unphased.vcf.gz \
      --positions ./input_files/chr16_SNV_genomic_positions_B38.txt \
      --output_dir ./output_files_test
```
ðŸ“Œ Note: If you specify `--output_dir`, make sure that directory exists before running the script:
```bash
 mkdir -p ./output_files_test
```

---

## License

This project is licensed under the **GNU General Public License v3.0 or later** (`GPL-3.0-or-later`).  
It uses the SPDX license identifier `GPL-3.0-or-later` in source files for standardized license declaration.

You can view the full license text at:  
https://www.gnu.org/licenses/gpl-3.0.html

Unless required by applicable law or agreed to in writing, the software is distributed  
**"AS IS"**, without warranties or conditions of any kind, either express or implied.

See the [LICENSE](https://github.com/RafPrograms/HaploGI/blob/main/LICENSE) file in this repository for complete details.

---

## Support

For questions, bug reports, or suggestions, please contact:  
ðŸ“§ nrafscience@gmail.com  
ðŸ”— [GitHub Issues](https://github.com/RafPrograms/HaploGI/issues)

